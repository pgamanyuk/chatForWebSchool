const newBtn=document.getElementById("btnBezhuini"),chatBtn=document.querySelector("#chatBtn"),chatInput=document.querySelector("#chatInput");let loginIO="";const chatArea=document.querySelector("#chatArea"),allchatusersArea=document.querySelector("#allchatusers"),chatBox=document.querySelector("#chatBox");function chatInputResize(){document.querySelectorAll("[data-autoresize]").forEach((function(e){e.style.boxSizing="border-box";let t=e.offsetHeight-e.clientHeight;e.addEventListener("input",(function(e){e.target.style.height="auto",e.target.style.height=e.target.scrollHeight+t+"px"})),e.removeAttribute("data-autoresize")}))}function sendConnectMessage(){socket.emit("chat message",{message:"systemConnectionCheckBIBA",login:loginIO})}function getSingleUserChat(){document.querySelectorAll(".allchatusers__item").forEach(e=>{e.addEventListener("click",t=>{loginIO=e.getAttribute("name"),sendConnectMessage(),clearMessages(),renderRecentMessages(loginIO)})})}function clearMessages(){document.querySelector("#chatArea");document.querySelectorAll(".messageItem").forEach(e=>{e.remove()})}function getAllUsers(){axios.get("https://stark-chamber-40248.herokuapp.com/getAllUsers").then((function(e){e.data.allUsersArr.forEach(e=>{const t=document.createElement("div");t.setAttribute("class","allchatusers__item"),t.setAttribute("name",e),t.innerHTML=`\n            <div class="allchatusers__logo">\n                <img class="allchatusers__logo-img" src="../img/adminBiba/hacker.png" alt="">\n            </div>\n            <div class="allchatusers__name">${e}</div>\n            \n            `,allchatusersArea.append(t)}),getSingleUserChat()})).catch((function(e){alert(e)}))}function renderRecentMessages(e){axios.post("https://stark-chamber-40248.herokuapp.com/renderRecentMessages",{login:e+"chats"}).then((function(e){let t;console.log(e.data),e.data.messages.reverse(),t=e.data.messages.length>=200?200:e.data.messages.length;for(let a=t-1;a>=0;a--){const t=e.data.messages[a];renderMessage(t.sender,t.date,t.message),chatArea.scrollBy(0,150)}})).catch((function(e){alert(e)}))}function decodeJwt(){axios.post("https://stark-chamber-40248.herokuapp.com/decodejwt",{token:localStorage.getItem("token")}).then((function(e){loginIO=e.data.login,getAllUsers(),renderRecentMessages(e.data.login),socket.on("chat message",(async function(e){console.log(e),await renderMessage(e.sender,e.date,e.message),console.log(loginIO),chatArea.scrollBy(0,150)}))})).catch((function(e){alert(e)}))}function renderMessage(e,t,a){let n=document.createElement("div");n.setAttribute("class","messageItem"),n.innerHTML=`\n    \n    <div class="messageItem__container">\n        <div class="messageItem__avatar">\n            <img class="messageItem__avatar-img" src="../img/biba/profile.png" alt="">\n        </div>\n        <div class="messageItem__content">\n            <div class="messagItem__info">\n                <div class="messageItem__name">${e}</div>\n                <div class="messageItem__date">${t}</div>\n            </div>\n            <div class="messageItem__text">${a}</div>\n        </div>\n    </div>\n    `,chatArea.append(n),n=""}axios.post("https://stark-chamber-40248.herokuapp.com/checkjwt",{token:localStorage.getItem("token")}).then((function(e){e.data.message?location.href="../signin/signin.html":decodeJwt()})).catch((function(e){alert(e)}));const socket=io("https://stark-chamber-40248.herokuapp.com");chatBtn.addEventListener("click",e=>{chatInput.value&&(socket.emit("chat message",{message:chatInput.value,login:loginIO,admin:"admin"}),chatInput.value="")}),document.addEventListener("keydown",e=>{"Enter"===e.code&&(e.preventDefault(),chatInput.value&&(socket.emit("chat message",{message:chatInput.value,login:loginIO,admin:"admin"}),chatInput.value="",e.preventDefault()))}),chatInput.addEventListener("keyup",e=>{chatInputResize(e,15,2)});